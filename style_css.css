/*
================================================================================
AnKing Prettify - Multi-Theme Framework (Full Version with Custom Background)
================================================================================
*/


/* --- General Reset & Layout Fix --- */
html {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
  box-sizing: border-box;
}
body {
  min-height: 100%;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  overflow-y: auto;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  background-image: var(--anki-background-image, url('starsky.jpeg'));
  background-color: var(--anki-background-color, #0a1326);
  background-attachment: fixed;
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  position: relative;
}
*, *::before, *::after {
  box-sizing: inherit;
}

/*
================================================================================
I.   COLOR PALETTE
================================================================================
*/
:root {
  --anki-background-image: url('starsky.jpeg');
  --anki-background-color: #0a1326;
  --anki-background-color-light: #f0f5ff;
  --anki-background-color-dark: #03060f;
  --anki-background-image-light: url('starsky.jpeg');
  --anki-background-image-dark: url('starsky.jpeg');
  --anki-background-overlay-light: linear-gradient(180deg, rgba(255, 255, 255, 0.32), rgba(255, 255, 255, 0));
  --anki-background-overlay-dark: rgba(4, 10, 24, 0.45);

  /* Palette fallback (runtime values provided by anking-shared.js) */
  --p-hue-bg: 200;
  --p-hue-accent: 210;
  --p-bg-s: 42%;
  --p-bg-l: 90%;
  --p-bg-l-dark: 12%;
  --p-accent-s: 58%;
  --p-accent-l: 48%;
  --p-accent-l-dark: 62%;
  --p-text-s: 26%;
  --p-text-l: 24%;
  --p-text-l-dark: 88%;
  --p-bold-fg: #ff7f50;
  --p-italic-fg: #6a5acd;
  --p-underline-fg: #20b2aa;
  --p-bold-italic-fg: #cd5c5c;
  --p-bold-fg-dark: #ffa07a;
  --p-italic-fg-dark: #da70d6;
  --p-underline-fg-dark: #48d1cc;
  --p-bold-italic-fg-dark: #f08080;

  /* Base layout & type ramp */
  --card-max-width: 100em;
  --font-family: "Rubik", "Inter", -apple-system, system-ui, "SF Pro", sans-serif;
  --font-family-serif: "Merriweather", "Georgia", serif;
  --font-family-mono: "Fira Code", "Courier New", monospace;
  --base-border-radius: 1.25em;

  /* Palette-derived tokens */
  --c-text-primary-light: hsl(var(--p-hue-bg), var(--p-text-s), var(--p-text-l));
  --c-text-secondary-light: hsl(var(--p-hue-bg), calc(var(--p-text-s) - 5%), calc(var(--p-text-l) + 20%));
  --c-accent-1-light: hsl(var(--p-hue-accent), var(--p-accent-s), var(--p-accent-l));
  --c-accent-2-light: hsl(var(--p-hue-accent), var(--p-accent-s), calc(var(--p-accent-l) - 10%));
  --c-divider-light: hsl(var(--p-hue-bg), calc(var(--p-bg-s) - 10%), calc(var(--p-bg-l) - 10%));

  --c-text-primary-dark: hsl(var(--p-hue-bg), 15%, 95%);
  --c-text-secondary-dark: hsl(var(--p-hue-bg), 10%, 80%);
  --c-accent-1-dark: hsl(var(--p-hue-accent), var(--p-accent-s), var(--p-accent-l-dark));
  --c-accent-2-dark: hsl(var(--p-hue-accent), var(--p-accent-s), calc(var(--p-accent-l-dark) - 10%));
  --c-divider-dark: hsl(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l-dark) + 18%));

  /* Mode-agnostic defaults (overwritten per body mode) */
  --text-primary: var(--c-text-primary-light);
  --text-secondary: var(--c-text-secondary-light);
  --accent-1: var(--c-accent-1-light);
  --accent-2: var(--c-accent-2-light);
  --divider: var(--c-divider-light);
  --bold-fg: var(--p-bold-fg);
  --italic-fg: var(--p-italic-fg);
  --underline-fg: var(--p-underline-fg);
  --bold-italic-fg: var(--p-bold-italic-fg);

  /* Shared theme defaults */
  --theme-card-radius: var(--base-border-radius);
  --theme-card-background: hsla(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) + 4%), 0.9);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: var(--divider);
  --theme-card-shadow: 0 10px 28px hsla(var(--p-hue-bg), calc(var(--p-text-s) + 6%), calc(var(--p-text-l) - 18%), 0.15);
  --theme-card-backdrop: blur(12px) saturate(125%);
  --theme-card-outline: transparent;

  --theme-table-radius: 0.6em;
  --theme-table-bg: hsla(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) + 2%), 0.42);
  --theme-table-border-width: 1px;
  --theme-table-border-style: solid;
  --theme-table-border-color: var(--divider);
  --theme-table-shadow: 0 3px 8px hsla(var(--p-hue-bg), calc(var(--p-text-s) + 10%), calc(var(--p-text-l) - 12%), 0.09);
  --theme-table-header-bg: hsla(var(--p-hue-accent), var(--p-accent-s), var(--p-accent-l), 0.18);
  --theme-table-header-border-bottom-width: 2px;
  --theme-table-header-border-bottom: var(--accent-1);
  --theme-table-header-border-right-width: 1px;
  --theme-table-header-border-right: var(--divider);
  --theme-table-cell-border-width: 1px;
  --theme-table-cell-border: var(--divider);
  --theme-table-stripe-bg: hsla(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) - 4%), 0.32);
  --theme-table-stripe-bg-night: hsla(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l-dark) + 3%), 0.3);

  --theme-button-bg: hsla(var(--p-hue-accent), 20%, 52%, 0.14);
  --theme-button-bg-hover: hsla(var(--p-hue-accent), 20%, 52%, 0.22);
  --theme-button-border-width: 1px;
  --theme-button-border-style: solid;
  --theme-button-border-color: hsla(var(--p-hue-accent), 20%, 52%, 0.24);
  --theme-button-color: var(--accent-1);
  --theme-button-radius: 0.75em;
  --theme-button-shadow: none;
  --theme-button-backdrop: none;

  --theme-img-shadow: 0 4px 12px hsla(var(--p-hue-bg), var(--p-text-s), calc(var(--p-text-l) - 16%), 0.14);
  --theme-img-shadow-hover: 0 8px 22px hsla(var(--p-hue-bg), var(--p-text-s), calc(var(--p-text-l) - 24%), 0.22);
  --theme-img-shadow-night: 0 4px 12px hsla(0, 0%, 0%, 0.28);
  --theme-img-shadow-hover-night: 0 8px 25px hsla(0, 0%, 0%, 0.36);

  /* Surface tokens (light/dark variants supplied by body selectors) */
  --anki-surface-glass: rgba(255, 255, 255, 0.12);
  --anki-surface-glass-border: rgba(255, 255, 255, 0.22);
  --anki-surface-solid: hsla(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) + 6%), 0.9);
  --anki-surface-solid-strong: hsla(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) + 10%), 0.95);
  --anki-surface-border-subtle: hsla(var(--p-hue-bg), calc(var(--p-bg-s) - 12%), calc(var(--p-bg-l) - 10%), 0.28);
  --anki-surface-border-strong: hsla(var(--p-hue-accent), var(--p-accent-s), calc(var(--p-accent-l) - 6%), 0.42);
  --anki-surface-button: hsla(var(--p-hue-accent), var(--p-accent-s), calc(var(--p-accent-l) + 6%), 0.35);
  --anki-surface-button-strong: hsla(var(--p-hue-accent), var(--p-accent-s), calc(var(--p-accent-l) + 12%), 0.5);
  --anki-surface-shadow-glass: 0 14px 32px rgba(15, 23, 42, 0.18);
  --anki-surface-shadow-solid: 0 18px 38px rgba(15, 23, 42, 0.2);
}

/* === MODIFICATION: Background Image & Full Screen Fix === */
html, body {
  height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
}
body::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: var(--anki-background-overlay, transparent);
  z-index: -1;
}
body:not(.night_mode) {
  --anki-background-image: var(--anki-background-image-light, url('starsky.jpeg'));
  --anki-background-overlay: var(--anki-background-overlay-light, linear-gradient(180deg, rgba(255, 255, 255, 0.32), rgba(255, 255, 255, 0)));
  --anki-background-color: var(--anki-background-color-light, #f0f5ff);

  --text-primary: var(--c-text-primary-light);
  --text-secondary: var(--c-text-secondary-light);
  --accent-1: var(--c-accent-1-light);
  --accent-2: var(--c-accent-2-light);
  --divider: var(--c-divider-light);
  --bold-fg: var(--p-bold-fg);
  --italic-fg: var(--p-italic-fg);
  --underline-fg: var(--p-underline-fg);
  --bold-italic-fg: var(--p-bold-italic-fg);

  --anki-surface-glass: color-mix(in srgb, rgba(255, 255, 255, 0.94) 80%, var(--anki-palette-base, #10294a) 20%);
  --anki-surface-glass-border: color-mix(in srgb, rgba(255, 255, 255, 0.65) 62%, var(--anki-palette-accent, #7faeff) 38%);
  --anki-surface-solid: color-mix(in srgb, rgba(255, 255, 255, 0.96) 72%, var(--anki-palette-base, #10294a) 28%);
  --anki-surface-solid-strong: color-mix(in srgb, rgba(255, 255, 255, 0.98) 68%, var(--anki-palette-base, #10294a) 32%);
  --anki-surface-border-subtle: color-mix(in srgb, var(--anki-palette-base, #10294a) 22%, rgba(255, 255, 255, 0.4) 78%);
  --anki-surface-border-strong: color-mix(in srgb, var(--anki-palette-accent, #7faeff) 58%, rgba(255, 255, 255, 0.32) 42%);
  --anki-surface-button: color-mix(in srgb, rgba(255, 255, 255, 0.94) 52%, var(--anki-palette-accent, #7faeff) 48%);
  --anki-surface-button-strong: color-mix(in srgb, rgba(255, 255, 255, 0.9) 38%, var(--anki-palette-accent, #7faeff) 62%);
  --anki-surface-shadow-glass: 0 16px 34px color-mix(in srgb, var(--anki-palette-base, #10294a) 26%, transparent);
  --anki-surface-shadow-solid: 0 20px 40px color-mix(in srgb, var(--anki-palette-base, #10294a) 30%, transparent);

  --theme-card-background: var(--anki-surface-solid);
  --theme-card-border-color: var(--anki-surface-border-subtle);
  --theme-card-shadow: var(--anki-surface-shadow-solid);
  --theme-card-backdrop: blur(14px) saturate(135%);
  --theme-table-bg: color-mix(in srgb, var(--anki-surface-solid) 70%, transparent 30%);
  --theme-table-border-color: var(--anki-surface-border-subtle);
  --theme-table-shadow: var(--anki-surface-shadow-glass);
  --theme-table-header-bg: color-mix(in srgb, var(--anki-surface-button) 60%, transparent 40%);
  --theme-table-header-border-right: color-mix(in srgb, var(--anki-surface-border-subtle) 65%, transparent 35%);
  --theme-table-header-border-bottom: var(--anki-surface-border-strong);
  --theme-table-cell-border: color-mix(in srgb, var(--anki-surface-border-subtle) 85%, transparent 15%);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 55%, transparent 45%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 65%, transparent 35%);
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-border-strong) 60%, transparent 40%);
  --theme-button-color: color-mix(in srgb, var(--text-primary) 88%, #ffffff 12%);
}
body.night_mode {
  --anki-background-image: var(--anki-background-image-dark, url('starsky.jpeg'));
  --anki-background-overlay: var(--anki-background-overlay-dark, rgba(4, 10, 24, 0.45));
  --anki-background-color: var(--anki-background-color-dark, #03060f);

  --text-primary: var(--c-text-primary-dark);
  --text-secondary: var(--c-text-secondary-dark);
  --accent-1: var(--c-accent-1-dark);
  --accent-2: var(--c-accent-2-dark);
  --divider: var(--c-divider-dark);
  --bold-fg: var(--p-bold-fg-dark);
  --italic-fg: var(--p-italic-fg-dark);
  --underline-fg: var(--p-underline-fg-dark);
  --bold-italic-fg: var(--p-bold-italic-fg-dark);

  --anki-surface-glass: color-mix(in srgb, var(--anki-palette-base, #050b16) 82%, rgba(8, 12, 20, 0.9) 18%);
  --anki-surface-glass-border: color-mix(in srgb, var(--anki-palette-accent, #7dafff) 52%, rgba(255, 255, 255, 0.18) 48%);
  --anki-surface-solid: color-mix(in srgb, var(--anki-palette-base, #050b16) 88%, rgba(9, 14, 24, 0.82) 12%);
  --anki-surface-solid-strong: color-mix(in srgb, var(--anki-palette-base, #050b16) 92%, rgba(255, 255, 255, 0.06) 8%);
  --anki-surface-border-subtle: color-mix(in srgb, var(--anki-palette-base, #050b16) 70%, rgba(255, 255, 255, 0.1) 30%);
  --anki-surface-border-strong: color-mix(in srgb, var(--anki-palette-accent, #7dafff) 68%, rgba(255, 255, 255, 0.22) 32%);
  --anki-surface-button: color-mix(in srgb, var(--anki-palette-accent, #7dafff) 62%, rgba(255, 255, 255, 0.08) 38%);
  --anki-surface-button-strong: color-mix(in srgb, var(--anki-palette-accent, #7dafff) 74%, rgba(255, 255, 255, 0.12) 26%);
  --anki-surface-shadow-glass: 0 18px 40px color-mix(in srgb, var(--anki-palette-base, #050b16) 45%, transparent);
  --anki-surface-shadow-solid: 0 22px 46px color-mix(in srgb, var(--anki-palette-base, #050b16) 52%, transparent);

  --theme-card-background: var(--anki-surface-solid);
  --theme-card-border-color: var(--anki-surface-border-subtle);
  --theme-card-shadow: var(--anki-surface-shadow-solid);
  --theme-card-backdrop: blur(16px) saturate(130%);
  --theme-table-bg: color-mix(in srgb, var(--anki-surface-solid) 68%, transparent 32%);
  --theme-table-border-color: var(--anki-surface-border-subtle);
  --theme-table-shadow: var(--anki-surface-shadow-glass);
  --theme-table-header-bg: color-mix(in srgb, var(--anki-surface-button) 70%, transparent 30%);
  --theme-table-header-border-right: color-mix(in srgb, var(--anki-surface-border-subtle) 68%, transparent 32%);
  --theme-table-header-border-bottom: var(--anki-surface-border-strong);
  --theme-table-cell-border: color-mix(in srgb, var(--anki-surface-border-subtle) 82%, transparent 18%);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 60%, transparent 40%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 72%, transparent 28%);
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-border-strong) 62%, transparent 38%);
  --theme-button-color: color-mix(in srgb, var(--text-primary) 92%, #ffffff 8%);
}
/* === END MODIFICATION === */


.card {
  color: var(--text-primary);
  font-family: var(--font-family);
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  /* MODIFIED: Add padding to respect iPhone safe areas (notch/home bar) */
  padding-top: calc(1em + env(safe-area-inset-top, 0px));
  padding-bottom: calc(1em + env(safe-area-inset-bottom, 0px));
  padding-left: calc(1em + env(safe-area-inset-left, 0px));
  padding-right: calc(1em + env(safe-area-inset-right, 0px));
}
.prettify-flashcard {
  font-size: 20px;
  line-height: 1.8;
  padding: 2.25em;
  margin: 1em auto;
  width: 100%;
  max-width: var(--card-max-width);
  text-align: center;
  word-wrap: break-word;
  color: var(--text-primary);
  transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
  will-change: transform, box-shadow, background-color, border, backdrop-filter;
  transform: translateZ(0);
  overflow: visible;
  position: relative; /* Needed for pseudo-elements */
  background: var(--theme-card-background, transparent);
  border-radius: var(--theme-card-radius, var(--base-border-radius));
  border-width: var(--theme-card-border-width, 0);
  border-style: var(--theme-card-border-style, none);
  border-color: var(--theme-card-border-color, transparent);
  box-shadow: var(--theme-card-shadow, none);
  backdrop-filter: var(--theme-card-backdrop, none);
  -webkit-backdrop-filter: var(--theme-card-backdrop, none);
  outline: var(--theme-card-outline, transparent);
}

.prettify-flashcard ::selection { background-color: var(--accent-2); color: white; }
.prettify-flashcard b, .prettify-flashcard strong { color: var(--bold-fg); }
.prettify-flashcard i, .prettify-flashcard em { color: var(--italic-fg); font-style: italic; }
.prettify-flashcard u { text-decoration-color: var(--underline-fg); color: var(--underline-fg); }
.prettify-flashcard b > i, .prettify-flashcard i > b { color: var(--bold-italic-fg); }
.prettify-flashcard .cloze { font-weight: bold; color: var(--accent-1); }
a { color: var(--accent-1); text-decoration: none; }
a:hover { color: var(--accent-2); text-decoration: underline;}
.prettify-deck { color: var(--text-secondary); font-size: 0.8em; }
.prettify-divider { border: none; border-bottom: 2px dashed var(--divider); margin: 1.5em; }

/*
================================================================================
III.  THEME DEFINITIONS & TOKEN MAPS
================================================================================
*/

/*
  Theme authoring guide:
  1. Assign card/table/button variables on the theme container (.theme-xyz).
  2. Use the optional night-mode block to adjust values when body has .night_mode.
  3. Keep bespoke decorative properties (pseudo-elements, animations) alongside
     the variable assignments so new themes can copy the structure.
*/

/* --- THEME: DEFAULT & FLUENT --- */
.theme-default,
.prettify-flashcard:not([class*="theme-"]),
.theme-fluent {
  --theme-card-background: var(--anki-surface-solid);
  --theme-card-backdrop: blur(16px) saturate(140%);
  --theme-card-radius: var(--base-border-radius);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: var(--anki-surface-border-subtle);
  --theme-card-shadow: var(--anki-surface-shadow-solid);
  --theme-table-bg: color-mix(in srgb, var(--anki-surface-solid) 72%, transparent 28%);
  --theme-table-border-color: var(--anki-surface-border-subtle);
  --theme-table-shadow: var(--anki-surface-shadow-glass);
  --theme-table-header-bg: color-mix(in srgb, var(--anki-surface-button) 64%, transparent 36%);
  --theme-table-header-border-bottom: var(--anki-surface-border-strong);
  --theme-table-header-border-right: color-mix(in srgb, var(--anki-surface-border-subtle) 70%, transparent 30%);
  --theme-table-cell-border: color-mix(in srgb, var(--anki-surface-border-subtle) 84%, transparent 16%);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 58%, transparent 42%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 68%, transparent 32%);
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-border-strong) 60%, transparent 40%);
  --theme-button-color: color-mix(in srgb, var(--text-primary) 90%, #ffffff 10%);
}
.theme-default .cloze,
.prettify-flashcard:not([class*="theme-"]) .cloze,
.theme-fluent .cloze {
  background-color: rgba(from var(--accent-1) r g b / 0.1);
  padding: 0.2em 0.6em;
  border-radius: 0.5em;
}

/* --- THEME: GLASSMORPHISM & GLASS-DEEP --- */
.theme-glassmorphism,
.theme-glass-deep {
  --theme-card-background: var(--anki-surface-glass);
  --theme-card-backdrop: blur(35px) saturate(170%) contrast(108%);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: var(--anki-surface-glass-border);
  --theme-card-shadow: inset 0 1.5px 1px color-mix(in srgb, var(--anki-palette-glow, #ffffff) 60%, transparent 40%), var(--anki-surface-shadow-glass);
  --theme-table-bg: color-mix(in srgb, var(--anki-surface-glass) 55%, transparent 45%);
  --theme-table-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 72%, transparent 28%);
  --theme-table-shadow: none;
  --theme-table-radius: 0.5em;
  --theme-table-header-bg: color-mix(in srgb, var(--anki-surface-button) 50%, transparent 50%);
  --theme-table-header-border-bottom: color-mix(in srgb, var(--anki-surface-border-strong) 60%, transparent 40%);
  --theme-table-header-border-right: color-mix(in srgb, var(--anki-surface-border-subtle) 68%, transparent 32%);
  --theme-table-cell-border: color-mix(in srgb, var(--anki-surface-border-subtle) 75%, transparent 25%);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 52%, transparent 48%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 62%, transparent 38%);
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 70%, transparent 30%);
  --theme-button-color: color-mix(in srgb, var(--text-primary) 92%, #ffffff 8%);
}

/* --- THEME: NEOBRUTALISM --- */
.theme-neobrutalism {
  --theme-card-background: hsl(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) + 2%));
  --theme-card-radius: 0;
  --theme-card-border-width: 3px;
  --theme-card-border-style: solid;
  --theme-card-border-color: var(--text-primary);
  --theme-card-shadow: 8px 8px 0 var(--text-primary);
  --theme-card-backdrop: none;
  --theme-button-bg: var(--p-bold-fg);
  --theme-button-bg-hover: color-mix(in srgb, var(--p-bold-fg) 80%, var(--text-primary) 20%);
  --theme-button-border-width: 2px;
  --theme-button-border-color: var(--text-primary);
  --theme-button-color: var(--text-primary);
  --theme-button-radius: 0;
  --theme-button-shadow: 3px 3px 0 var(--text-primary);
}
body.night_mode .theme-neobrutalism {
  --theme-card-background: hsl(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l-dark));
}

/* --- THEME: CLAYMORPHISM --- */
.theme-claymorphism {
  --theme-card-background: hsl(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l));
  --theme-card-radius: 50px 20px 40px 15px / 30px 45px 25px 55px;
  --theme-card-border-width: 0;
  --theme-card-border-style: none;
  --theme-card-shadow: inset -6px -6px 12px color-mix(in srgb, var(--anki-palette-glow, #ffffff) 58%, transparent 42%), inset 6px 6px 16px rgba(0, 0, 0, 0.1), 10px 10px 20px rgba(0, 0, 0, 0.1);
  --theme-card-backdrop: none;
  --theme-button-bg: hsl(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l));
  --theme-button-bg-hover: hsl(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) + 2%));
  --theme-button-border-style: none;
  --theme-button-border-width: 0;
  --theme-button-shadow: -4px -4px 8px color-mix(in srgb, var(--anki-palette-glow, #ffffff) 58%, transparent 42%), 4px 4px 8px rgba(0, 0, 0, 0.1);
}
body.night_mode .theme-claymorphism {
  --theme-card-background: hsl(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l-dark));
  --theme-card-shadow: inset -6px -6px 12px color-mix(in srgb, var(--anki-palette-glow, #ffffff) 18%, transparent 82%), inset 6px 6px 16px rgba(0, 0, 0, 0.3), 10px 10px 20px rgba(0, 0, 0, 0.3);
  --theme-button-bg: hsl(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l-dark));
  --theme-button-bg-hover: hsl(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l-dark) + 4%));
  --theme-button-shadow: -4px -4px 8px color-mix(in srgb, var(--anki-palette-glow, #ffffff) 22%, transparent 78%), 4px 4px 8px rgba(0, 0, 0, 0.3);
}

/* --- THEME: MINIMALIST --- */
.theme-minimalist {
  --theme-card-background: hsl(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) + 2%));
  --theme-card-border-width: 2px;
  --theme-card-border-style: solid;
  --theme-card-border-color: var(--text-primary);
  --theme-card-radius: 4px;
  --theme-card-shadow: none;
  --theme-card-backdrop: none;
  font-family: var(--font-family-mono);
}
body.night_mode .theme-minimalist {
  --theme-card-background: hsl(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l-dark));
}

/* --- THEME: ACRYLIC --- */
.theme-acrylic {
  --acrylic-noise: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWDg4N3d3dtbW17e3t1dXVrbW1sZWVjaGhxeXlgYGBkcXFiYmJhaGhhYWF4d3d0dHRsbGxlYmPEg4O0o6Ovq6vFh4eDg4N6enpsbW1qaGptZ2drB7rdAAAANXRSTlMACQkLCwsKCQkLCwsKCQkLCwsKCQkLCwsKCQkLCwsKCQkLCwsKCQkLCwsKCQkLCwsKCQkLCwsKCQkLCwsKCQkLCwsK+wN8VwAAATNJREFUSMe1l9tygyAQRRUR8dG1vX3/t3UQqhGUEOlmM9k3b5bDeStVlpZWVpZNV0ySYl3EZeL2Ecnz9RlYllrv25p7zW2v3kAa+A1U7fpvA427tB+o2/gYkL8nL+A2I38nL+BCR/5+voBSr/x8/wBpH/l5QQGUn/l5/wAClH/l/SoBaXH+k/wD5Dz9k/wDBCj/qf8DdLr8p/4PCMz/p/8HhHX9K/8HjOr6V/8PqN35T/8PIMH5T/8PyNX5T/8P6Br8p/8PlBz8p/8PlBz4p/8PCAb+U/8PCAb+k/8PcBv4T/8PuBz4T/8PqNv4T/8P6A/8p/8P6A/8J/8PcA/8J/8PqA/8J/8PqA/8p/8PuA/4p/8PCAb+U/8PCAb+k/8PuBv4T/8PCAb+k/8P6Br8p/8PIMH5T/8PqN35T/8PjOr6V/8PCOv6V/8PCMz/p/8HdLr8p/wPqA/8p/wDBCj/qf8D5Dz9k/wD5Hj+k/wDBlD/l/SoBWFx/pP8A6Vf+fn+ANKv/Hy/AClX/n5+gNGv/Hy/AAlb+Tl/AxI28nL+A4Q18nL+AyQ28nL+AxSN/JO3/gGkG/k7f+AGQN/JOv/gGk2/knb/gBVLfxT3/gBURb+KWv/gGru/FN/+AFUt/JO3/gAVJf/JO/+AFUl/JOv/gBkv/FPf+AEyA/8nb/gBkv/FP/gAmA/8nb/gAkv/FP/gAmQ3/knb/gCkv/J2/8Akg3/knb/gCUhT/JO/+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AEwB/8nb/gAwB/8k7f+AFQl/8nb/gCpBv+Tt/4AlBr+Tt/4AFQG/knb/gBUpP/J2/8AFLb+Sd/+ACCGv5J2/8AQEH/knb/wBCQH/knb/wBCQH/knb/wBCQH/knb/wBCQH/knb/wBCQH/knb/wBCQH/knb/wBAwH/knb/wBAwH/knb/wBAwH/knb/wBCQH/knb/wBAwH/knb/wBCQH/knb/wBAQH/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBAQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCQX/knb/wBCTH8k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7f+AEyW38k7e8/p8ADAH8D6l2L8YAAAAASUVORK5CYII=);
  --theme-card-background: hsla(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l), 0.7);
  --theme-card-backdrop: blur(50px) saturate(120%);
  --theme-card-radius: 0.8em;
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: hsla(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l), 0.1);
  --theme-card-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  --theme-button-backdrop: blur(10px);
  background-image: var(--acrylic-noise);
}
body.night_mode .theme-acrylic {
  --theme-card-background: hsla(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l-dark), 0.65);
  --theme-card-border-color: hsla(var(--p-hue-bg), var(--p-bg-s), var(--p-bg-l-dark), 0.2);
}

/* --- THEME: GELATIN, QUARTZ, OBSIDIAN, HOLOGRAPHIC --- */
.theme-gelatin {
  --theme-card-background: rgba(from var(--accent-1) r g b / 0.15);
  --theme-card-backdrop: blur(15px);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: rgba(from var(--accent-1) r g b / 0.2);
  --theme-card-radius: 3em;
  --theme-card-shadow: none;
}
.theme-quartz {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-solid-strong) 80%, transparent 20%);
  --theme-card-backdrop: blur(14px) saturate(150%);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-border-subtle) 70%, transparent 30%);
  --theme-card-radius: 0.5em;
  --theme-card-shadow: inset 0 0 20px color-mix(in srgb, var(--anki-surface-solid) 42%, transparent 58%);
}
body.night_mode .theme-quartz {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-solid) 82%, transparent 18%);
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-border-subtle) 78%, transparent 22%);
  --theme-card-shadow: inset 0 0 20px color-mix(in srgb, var(--anki-surface-solid) 55%, transparent 45%);
}
.theme-obsidian {
  --theme-card-background: linear-gradient(145deg, hsl(var(--p-hue-bg), 10%, 25%), hsl(var(--p-hue-bg), 10%, 15%));
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: hsl(var(--p-hue-bg), 10%, 35%);
  --theme-card-radius: 0.75em;
  --theme-card-shadow: inset 0 1px 1px hsl(var(--p-hue-bg), 10%, 30%), 0 5px 15px rgba(0, 0, 0, 0.3);
  --theme-button-bg: hsl(var(--p-hue-bg), 10%, 22%);
  --theme-button-bg-hover: hsl(var(--p-hue-bg), 10%, 26%);
  --theme-button-border-color: hsl(var(--p-hue-bg), 10%, 35%);
  --theme-button-color: var(--text-primary);
  position: relative;
  overflow: hidden;
}
.theme-obsidian::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at 70% 20%, hsla(var(--p-hue-accent), 50%, 60%, 0.3), transparent 40%);
  opacity: 0.5;
  mix-blend-mode: soft-light;
  pointer-events: none;
}
body.night_mode .theme-obsidian {
  --theme-card-background: linear-gradient(145deg, hsl(var(--p-hue-bg), 10%, 18%), hsl(var(--p-hue-bg), 10%, 8%));
  --theme-card-border-color: hsl(var(--p-hue-bg), 10%, 25%);
  --theme-button-bg: hsl(var(--p-hue-bg), 10%, 12%);
  --theme-button-bg-hover: hsl(var(--p-hue-bg), 10%, 18%);
  --theme-button-border-color: hsl(var(--p-hue-bg), 10%, 25%);
}
.theme-holographic {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-glass) 68%, transparent 32%);
  --theme-card-backdrop: blur(24px) saturate(175%);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 68%, transparent 32%);
  --theme-card-radius: var(--base-border-radius);
  --theme-card-shadow: inset 0 1px 0 color-mix(in srgb, var(--anki-palette-glow, #ffffff) 45%, transparent 55%), var(--anki-surface-shadow-glass);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 50%, transparent 50%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 60%, transparent 40%);
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 65%, transparent 35%);
  --theme-button-color: color-mix(in srgb, var(--text-primary) 90%, #ffffff 10%);
  position: relative;
  overflow: hidden;
}
.theme-holographic .holo-sheen {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at var(--x, 50%) var(--y, 50%), hsla(0, 100%, 100%, 0.3), transparent 40%);
  background-blend-mode: screen;
  transition: transform 0.1s ease-out;
  pointer-events: none;
}

/* --- THEME: LIQUID GLASS --- */
.theme-liquid-glass {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-glass) 70%, transparent 30%);
  --theme-card-backdrop: blur(50px) saturate(160%);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 75%, transparent 25%);
  --theme-card-radius: calc(var(--base-border-radius) + 10px);
  --theme-card-shadow: 0 8px 32px 0 color-mix(in srgb, var(--anki-palette-base, #10294a) 22%, transparent);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 48%, transparent 52%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 60%, transparent 40%);
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-border-strong) 58%, transparent 42%);
  --theme-button-color: color-mix(in srgb, var(--text-primary) 92%, #ffffff 8%);
  overflow: hidden;
}
body.night_mode .theme-liquid-glass {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-glass) 78%, transparent 22%);
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-border-subtle) 74%, transparent 26%);
  --theme-card-shadow: 0 8px 32px 0 color-mix(in srgb, var(--anki-palette-base, #050b16) 38%, transparent);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 54%, transparent 46%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 66%, transparent 34%);
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-border-strong) 64%, transparent 36%);
}
.theme-liquid-glass::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle at 70% 30%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 50%, transparent 50%), transparent 30%);
  z-index: -1;
  opacity: 0.5;
}
body.night_mode .theme-liquid-glass::after {
  background: radial-gradient(circle at 70% 30%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 28%, transparent 72%), transparent 35%);
}

/* --- THEME: LIQUID APPLE --- */
.theme-liquid-apple {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-glass) 78%, transparent 22%);
  --theme-card-backdrop: blur(30px) saturate(165%) contrast(108%);
  --theme-card-radius: calc(var(--base-border-radius) + 8px);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 74%, transparent 26%);
  --theme-card-shadow: inset 0 1px 0 color-mix(in srgb, var(--anki-palette-glow, #ffffff) 55%, transparent 45%), var(--anki-surface-shadow-glass);
  position: relative;
  background: var(--theme-card-background);
  background-clip: padding-box;
  overflow: hidden;
}
.theme-liquid-apple::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--anki-surface-border-strong) 65%, transparent 35%);
  opacity: 0.75;
}
.theme-liquid-apple::after {
  content: '';
  position: absolute;
  inset: -20% -20% auto -20%;
  height: 60%;
  border-radius: 50%;
  background: radial-gradient(120% 120% at 50% -10%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 45%, transparent) 0%, color-mix(in srgb, var(--anki-surface-glass) 40%, transparent) 45%, transparent 65%);
  filter: blur(10px);
  pointer-events: none;
}
.theme-liquid-apple {
  background-image: radial-gradient(50% 120% at 60% 0%, color-mix(in srgb, var(--anki-surface-button) 35%, transparent 65%) 0%, transparent 60%);
}
body.night_mode .theme-liquid-apple {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-glass) 82%, transparent 18%);
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-border-subtle) 72%, transparent 28%);
  --theme-card-shadow: inset 0 1px 0 color-mix(in srgb, var(--anki-palette-glow, #ffffff) 24%, transparent 76%), var(--anki-surface-shadow-glass);
  background: var(--theme-card-background);
}
body.night_mode .theme-liquid-apple::before {
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--anki-surface-border-strong) 72%, transparent 28%);
  opacity: 0.55;
}
body.night_mode .theme-liquid-apple::after {
  background: radial-gradient(120% 120% at 50% -10%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 28%, transparent) 0%, color-mix(in srgb, var(--anki-surface-glass) 28%, transparent) 45%, transparent 65%);
}

/* --- THEME: VITREOUS --- */
.theme-vitreous {
  --theme-card-background: linear-gradient(180deg, color-mix(in srgb, var(--anki-surface-glass) 82%, transparent 18%), color-mix(in srgb, var(--anki-surface-glass) 60%, transparent 40%));
  --theme-card-backdrop: blur(28px) saturate(175%);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 70%, transparent 30%);
  --theme-card-radius: calc(var(--base-border-radius) + 12px);
  --theme-card-shadow: inset 0 1px 0 color-mix(in srgb, var(--anki-palette-glow, #ffffff) 42%, transparent 58%), var(--anki-surface-shadow-glass);
  position: relative;
  overflow: hidden;
  background: var(--theme-card-background);
  background-clip: padding-box;
}
.theme-vitreous::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background: radial-gradient(120% 100% at 80% -10%, color-mix(in srgb, var(--anki-surface-button-strong) 40%, transparent 60%) 0%, transparent 55%),
              linear-gradient(180deg, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 32%, transparent 68%), color-mix(in srgb, var(--anki-surface-glass) 32%, transparent 68%) 40%, color-mix(in srgb, rgba(0, 0, 0, 0.08) 70%, transparent 30%) 100%);
  mix-blend-mode: soft-light;
}
.theme-vitreous::after {
  content: '';
  position: absolute;
  top: -20%;
  left: -10%;
  right: -10%;
  height: 55%;
  background: linear-gradient(to bottom, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 48%, transparent) 0%, color-mix(in srgb, var(--anki-surface-glass) 32%, transparent) 40%, transparent 100%);
  transform: rotate(2deg);
  filter: blur(8px);
  pointer-events: none;
}
body.night_mode .theme-vitreous {
  --theme-card-background: linear-gradient(180deg, color-mix(in srgb, var(--anki-surface-glass) 86%, transparent 14%), color-mix(in srgb, var(--anki-surface-solid) 60%, transparent 40%));
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-border-subtle) 76%, transparent 24%);
  --theme-card-shadow: inset 0 1px 0 color-mix(in srgb, var(--anki-palette-glow, #ffffff) 18%, transparent 82%), var(--anki-surface-shadow-glass);
}
body.night_mode .theme-vitreous::before {
  background: radial-gradient(120% 100% at 80% -10%, color-mix(in srgb, var(--anki-surface-button-strong) 48%, transparent 52%) 0%, transparent 55%),
              linear-gradient(180deg, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 18%, transparent 82%), color-mix(in srgb, var(--anki-surface-glass) 22%, transparent 78%) 40%, color-mix(in srgb, rgba(0, 0, 0, 0.25) 70%, transparent 30%) 100%);
}
body.night_mode .theme-vitreous::after {
  background: linear-gradient(to bottom, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 24%, transparent 76%) 0%, color-mix(in srgb, var(--anki-surface-glass) 18%, transparent 82%) 40%, transparent 100%);
}

/* --- THEME: STARFIELD MINIMAL --- */
.theme-starfield-minimal {
  --theme-card-background: color-mix(in srgb, var(--anki-palette-base, #0f1e35) 82%, var(--anki-surface-glass) 18%);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: color-mix(in srgb, var(--anki-palette-accent, #7faeff) 40%, transparent);
  --theme-card-radius: 20px;
  --theme-card-shadow: 0 22px 40px color-mix(in srgb, var(--anki-palette-base, #0f1e35) 70%, transparent),
                      0 0 0 1px color-mix(in srgb, var(--anki-palette-accent, #7faeff) 25%, transparent);
  --theme-card-backdrop: blur(10px) saturate(125%);
  --theme-table-bg: color-mix(in srgb, var(--anki-palette-base, #0f1e35) 55%, color-mix(in srgb, var(--anki-surface-solid) 40%, transparent 60%));
  --theme-table-border-color: color-mix(in srgb, var(--anki-palette-accent, #7faeff) 30%, transparent);
  --theme-table-shadow: 0 16px 28px color-mix(in srgb, var(--anki-palette-base, #0f1e35) 60%, transparent);
  --theme-table-header-bg: color-mix(in srgb, var(--anki-palette-accent, #7faeff) 22%, transparent);
  --theme-table-cell-border: color-mix(in srgb, var(--anki-palette-accent, #7faeff) 18%, transparent);
  --theme-button-bg: color-mix(in srgb, var(--anki-palette-accent, #7faeff) 28%, transparent);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-palette-accent, #7faeff) 42%, transparent);
  --theme-button-border-color: color-mix(in srgb, var(--anki-palette-accent, #7faeff) 46%, transparent);
  --theme-button-color: color-mix(in srgb, #ffffff 90%, var(--anki-palette-text, #d6e8ff) 10%);
  --theme-button-shadow: 0 14px 30px color-mix(in srgb, var(--anki-palette-base, #0f1e35) 65%, transparent);
  --theme-img-shadow: 0 18px 32px color-mix(in srgb, var(--anki-palette-base, #0f1e35) 70%, transparent);
  --theme-img-shadow-hover: 0 28px 42px color-mix(in srgb, var(--anki-palette-base, #0f1e35) 75%, transparent);
}
.theme-starfield-minimal::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background:
    radial-gradient(circle at 18% 22%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 55%, transparent) 0%, transparent 55%),
    radial-gradient(circle at 78% 14%, color-mix(in srgb, var(--anki-palette-accent, #7faeff) 40%, transparent) 0%, transparent 52%),
    radial-gradient(circle at 35% 78%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 25%, transparent) 0%, transparent 50%);
  mix-blend-mode: screen;
  pointer-events: none;
}
.theme-starfield-minimal::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: radial-gradient(circle, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 32%, transparent 68%) 0%, transparent 70%);
  opacity: 0.35;
  mix-blend-mode: soft-light;
  animation: starfield-twinkle 14s ease-in-out infinite alternate;
  pointer-events: none;
}
body.night_mode .theme-starfield-minimal {
  --theme-card-background: color-mix(in srgb, var(--anki-palette-base, #050b16) 86%, var(--anki-surface-glass) 14%);
  --theme-card-border-color: color-mix(in srgb, var(--anki-palette-accent, #7dafff) 45%, transparent);
  --theme-button-bg: color-mix(in srgb, var(--anki-palette-accent, #7dafff) 32%, transparent);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-palette-accent, #7dafff) 50%, transparent);
  --theme-button-border-color: color-mix(in srgb, var(--anki-palette-accent, #7dafff) 55%, transparent);
  --theme-button-color: color-mix(in srgb, var(--anki-palette-text, #e6efff) 92%, #ffffff 8%);
  --theme-table-bg: color-mix(in srgb, var(--anki-palette-base, #050b16) 68%, color-mix(in srgb, var(--anki-surface-solid) 38%, transparent 62%));
}
body.night_mode .theme-starfield-minimal::before {
  background:
    radial-gradient(circle at 22% 26%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 45%, transparent) 0%, transparent 55%),
    radial-gradient(circle at 80% 20%, color-mix(in srgb, var(--anki-palette-accent, #7dafff) 38%, transparent) 0%, transparent 52%),
    radial-gradient(circle at 38% 82%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 22%, transparent) 0%, transparent 50%);
  filter: blur(2px);
}/* --- THEME: APPLE GLASS REFRACTION --- */
.theme-apple-glass {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-glass) 74%, transparent 26%);
  --theme-card-backdrop: blur(34px) saturate(185%) contrast(112%);
  --theme-card-border-width: 1px;
  --theme-card-border-style: solid;
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 72%, transparent 28%);
  --theme-card-radius: calc(var(--base-border-radius) + 14px);
  --theme-card-shadow: 0 18px 40px color-mix(in srgb, var(--anki-palette-base, #10294a) 28%, transparent), 0 0 0 1px color-mix(in srgb, var(--anki-surface-glass-border) 58%, transparent 42%);
  --theme-table-bg: color-mix(in srgb, var(--anki-surface-glass) 55%, transparent 45%);
  --theme-table-border-color: color-mix(in srgb, var(--anki-surface-glass-border) 64%, transparent 36%);
  --theme-table-shadow: 0 12px 24px color-mix(in srgb, var(--anki-palette-base, #10294a) 24%, transparent);
  --theme-table-header-bg: color-mix(in srgb, var(--anki-surface-button) 58%, transparent 42%);
  --theme-table-header-border-bottom: color-mix(in srgb, var(--anki-surface-border-strong) 66%, transparent 34%);
  --theme-table-cell-border: color-mix(in srgb, var(--anki-surface-border-subtle) 70%, transparent 30%);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 60%, transparent 40%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 72%, transparent 28%);
  --theme-button-border-width: 1px;
  --theme-button-border-style: solid;
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-border-strong) 68%, transparent 32%);
  --theme-button-color: color-mix(in srgb, var(--text-primary) 86%, #ffffff 14%);
  --theme-button-shadow: 0 10px 24px color-mix(in srgb, var(--anki-palette-base, #10294a) 26%, transparent);
  --theme-button-backdrop: blur(24px);
  --theme-img-shadow: 0 20px 38px color-mix(in srgb, var(--anki-palette-base, #10294a) 26%, transparent);
  --theme-img-shadow-hover: 0 28px 44px color-mix(in srgb, var(--anki-palette-base, #10294a) 32%, transparent);
}
.theme-apple-glass::before,
.theme-apple-glass::after {
  content: '';
  position: absolute;
  inset: -12%;
  border-radius: inherit;
  pointer-events: none;
  mix-blend-mode: screen;
}
.theme-apple-glass::before {
  background:
    radial-gradient(40% 50% at 20% 15%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 55%, transparent 45%), transparent 75%),
    radial-gradient(60% 55% at 80% 25%, color-mix(in srgb, var(--anki-surface-button-strong) 45%, transparent 55%), transparent 80%),
    radial-gradient(60% 65% at 50% 80%, color-mix(in srgb, var(--anki-surface-button) 38%, transparent 62%), transparent 78%);
  filter: blur(12px);
  opacity: 0.9;
}
.theme-apple-glass::after {
  background:
    conic-gradient(from 180deg at 50% 10%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 60%, transparent 40%), transparent 60%),
    radial-gradient(30% 80% at 50% 0%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 48%, transparent 52%), transparent 70%);
  opacity: 0.75;
  transform: translateY(-8%) rotate(2deg);
}
.theme-apple-glass .prettify-divider {
  border-bottom-style: solid;
  border-bottom-color: color-mix(in srgb, var(--anki-surface-border-strong) 66%, transparent 34%);
  border-bottom-width: 1px;
}
.theme-apple-glass table {
  backdrop-filter: blur(22px);
  -webkit-backdrop-filter: blur(22px);
}
.theme-apple-glass .button-general::before {
  content: '';
  position: absolute;
  inset: 2px;
  border-radius: inherit;
  background: linear-gradient(145deg, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 75%, transparent 25%), color-mix(in srgb, var(--anki-surface-glass) 35%, transparent 65%));
  opacity: 0.65;
  transition: opacity 0.25s ease;
  pointer-events: none;
}
.theme-apple-glass .button-general:hover::before {
  opacity: 0.85;
}
body.night_mode .theme-apple-glass {
  --theme-card-background: color-mix(in srgb, var(--anki-surface-glass) 82%, transparent 18%);
  --theme-card-border-color: color-mix(in srgb, var(--anki-surface-border-subtle) 70%, transparent 30%);
  --theme-card-shadow: 0 28px 46px color-mix(in srgb, var(--anki-palette-base, #050b16) 42%, transparent), 0 0 0 1px color-mix(in srgb, var(--anki-surface-border-subtle) 65%, transparent 35%);
  --theme-table-bg: color-mix(in srgb, var(--anki-surface-glass) 60%, transparent 40%);
  --theme-table-border-color: color-mix(in srgb, var(--anki-surface-border-subtle) 68%, transparent 32%);
  --theme-table-header-bg: color-mix(in srgb, var(--anki-surface-button) 60%, transparent 40%);
  --theme-table-cell-border: color-mix(in srgb, var(--anki-surface-border-subtle) 70%, transparent 30%);
  --theme-button-bg: color-mix(in srgb, var(--anki-surface-button) 62%, transparent 38%);
  --theme-button-bg-hover: color-mix(in srgb, var(--anki-surface-button-strong) 74%, transparent 26%);
  --theme-button-border-color: color-mix(in srgb, var(--anki-surface-border-strong) 68%, transparent 32%);
  --theme-button-color: color-mix(in srgb, var(--text-primary) 92%, #ffffff 8%);
}
body.night_mode .theme-apple-glass::before {
  background:
    radial-gradient(40% 55% at 20% 20%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 35%, transparent 65%), transparent 75%),
    radial-gradient(55% 60% at 80% 28%, color-mix(in srgb, var(--anki-surface-button-strong) 42%, transparent 58%), transparent 80%),
    radial-gradient(55% 70% at 50% 82%, color-mix(in srgb, var(--anki-surface-button) 32%, transparent 68%), transparent 78%);
  filter: blur(20px);
}
body.night_mode .theme-apple-glass::after {
  background:
    conic-gradient(from 200deg at 50% 12%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 45%, transparent 55%), transparent 70%),
    radial-gradient(30% 85% at 48% -5%, color-mix(in srgb, var(--anki-palette-glow, #ffffff) 32%, transparent 68%), transparent 70%);
  opacity: 0.65;
}
/* === END NEW THEME === */


/*
================================================================================
IV.   THEME-AWARE TABLE STYLES
================================================================================
*/

/* --- BASE TABLE STYLES --- */
.prettify-flashcard table {
  width: auto;
  max-width: 95%;
  margin: 1.5em auto;
  border-collapse: separate;
  border-spacing: 0;
  border: 1px solid var(--divider);
  border-radius: 0.6em;
  font-size: 0.9em;
  box-shadow: 0 2px 5px hsla(var(--p-hue-bg), calc(var(--p-text-s) + 10%), calc(var(--p-text-l) - 10%), 0.07);
  overflow: hidden;
  color: var(--text-primary);
}

.prettify-flashcard th,
.prettify-flashcard td {
  padding: 0.75em 1em;
  text-align: left;
  border-bottom: 1px solid var(--divider);
}

.prettify-flashcard td:not(:last-child),
.prettify-flashcard th:not(:last-child) {
  border-right: 1px solid var(--divider);
}

.prettify-flashcard th {
  background-color: rgba(from var(--accent-1) r g b / 0.1);
  color: var(--accent-1);
  font-weight: bold;
  border-bottom-width: 2px;
  border-bottom-color: var(--accent-1);
}

.prettify-flashcard tr:last-child td {
  border-bottom: none;
}

.prettify-flashcard:not(body.night_mode *) tbody tr:nth-child(even) td {
  background-color: hsla(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) - 3%), 0.3);
}

body.night_mode .prettify-flashcard tbody tr:nth-child(even) td {
  background-color: hsla(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l-dark) + 3%), 0.3);
}

.mobile .prettify-flashcard table {
  display: block; width: 100%; max-width: 100%; overflow-x: auto; white-space: nowrap; font-size: 0.8em; margin: 1em 0; border-radius: 0.5em;
}
.mobile .prettify-flashcard th,
.mobile .prettify-flashcard td {
  white-space: normal;
  padding: 0.5em 0.75em;
}

/* --- THEME-SPECIFIC TABLE EXTRAS --- */
.theme-neobrutalism table {
  --theme-table-bg: hsl(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l) + 3%));
  --theme-table-border-width: 3px;
  --theme-table-border-style: solid;
  --theme-table-border-color: var(--text-primary);
  --theme-table-radius: 0;
  --theme-table-shadow: 6px 6px 0 var(--text-primary);
  --theme-table-cell-border: var(--text-primary);
  --theme-table-cell-border-width: 3px;
  --theme-table-header-border-bottom-width: 3px;
  --theme-table-header-border-bottom: var(--text-primary);
  --theme-table-header-border-right: var(--text-primary);
}
body.night_mode .theme-neobrutalism table {
  --theme-table-bg: hsl(var(--p-hue-bg), var(--p-bg-s), calc(var(--p-bg-l-dark) + 2%));
}
.theme-neobrutalism th,
.theme-neobrutalism td {
  border-bottom-width: 3px;
}
.theme-neobrutalism td:not(:last-child),
.theme-neobrutalism th:not(:last-child) {
  border-right-width: 3px;
}

/*
================================================================================
V.   THEME-AWARE BUTTONS
================================================================================
*/
.button-general {
  outline: 0;
  border-radius: var(--theme-button-radius, 0.75em);
  padding: 0.8em 1.2em;
  text-align: center;
  display: inline-block;
  font-size: 0.85rem;
  font-weight: 600;
  margin: 10px 5px;
  cursor: pointer;
  transition: all 0.2s ease-out;
  position: relative;
  background-color: var(--theme-button-bg, hsla(var(--p-hue-accent), 20%, 50%, 0.1));
  color: var(--theme-button-color, var(--accent-1)) !important;
  border-width: var(--theme-button-border-width, 1px);
  border-style: var(--theme-button-border-style, solid);
  border-color: var(--theme-button-border-color, hsla(var(--p-hue-accent), 20%, 50%, 0.2));
  box-shadow: var(--theme-button-shadow, none);
  backdrop-filter: var(--theme-button-backdrop, none);
  -webkit-backdrop-filter: var(--theme-button-backdrop, none);
}

.button-general:hover {
  background-color: var(--theme-button-bg-hover, hsla(var(--p-hue-accent), 20%, 50%, 0.2));
  border-color: var(--accent-2);
}

.button-general:active,
.button-general.expanded-button {
  transform: translateY(1px);
}

/*
================================================================================
VI.  MISCELLANEOUS & ANKING STYLES
================================================================================
*/
#tags-container { display: none; }
.mobile .card { padding: 0.8em; }
.mobile .prettify-flashcard { padding: 1em; margin: 0; width: 100%; max-width: 100%; }
.prettify-field { margin: 1.5em; }
.mobile .prettify-field { margin: 1em; }

/* Image Styling */
img {
  border-radius: 0.5em; display: block; margin: 1em auto; max-width: 60% !important; height: auto; transition: transform 0.25s ease-in-out, box-shadow 0.2s ease-in-out;
}
.card:not(.night_mode) .prettify-flashcard img {
  box-shadow: var(--theme-img-shadow, 0 4px 10px hsla(var(--p-hue-bg), var(--p-text-s), calc(var(--p-text-l) - 15%), 0.12));
}
body.night_mode .prettify-flashcard img {
  box-shadow: var(--theme-img-shadow-night, 0 4px 12px hsla(0, 0%, 0%, 0.25));
}
.mobile img { max-width: 100% !important; height: auto !important; }
html:not(.mobile) .prettify-flashcard img:hover { transform: scale(1.3); cursor: zoom-in; }
html:not(.mobile) .card:not(.night_mode) .prettify-flashcard img:hover {
  box-shadow: var(--theme-img-shadow-hover, 0 8px 20px hsla(var(--p-hue-bg), var(--p-text-s), calc(var(--p-text-l) - 25%), 0.2));
}
html:not(.mobile) body.night_mode .prettify-flashcard img:hover {
  box-shadow: var(--theme-img-shadow-hover-night, 0 8px 25px hsla(0, 0%, 0%, 0.35));
}
html:not(.mobile) .prettify-flashcard img:active {
  transform: scale(1.05);
  cursor: zoom-out;
}

/* Other styles */
.timer { display: none; }
.mobile #tags-container { display: none; }
.hints { font-size: .9rem; }
@keyframes card-bounce { 0%, 100% { transform: scale(1) translateZ(0); } 30% { transform: scale(1.03) translateZ(0); } 60% { transform: scale(0.98) translateZ(0); } }
.card-bounce-animation { animation: card-bounce 0.5s cubic-bezier(0.25, 0.1, 0.25, 1.5); }
#pic { opacity: 0.0; height: 40px; width: auto; border: 0; position: fixed; bottom: 15px; right: 15px; display: block; transition: opacity 0.3s ease; z-index: 1000; }
#pic:hover { opacity: 1; } .mobile #pic { display: none; }


/* === MODIFICATION: Readability Improvement (Text Shadow) === */
body.night_mode .prettify-flashcard,
body.night_mode .prettify-deck,
body.night_mode .cloze,
body.night_mode b,
body.night_mode i,
body.night_mode u {
  text-shadow: 0px 1px 4px rgba(0, 0, 0, 0.7);
}
/* === END MODIFICATION === */


/* ===== Windows stability fixes (Chromium/QtWebEngine) ===== */

/* Avoid paint deferral caused by hidden/overflow combos */
.is-windows html,
.is-windows body {
  overflow: auto !important;
}
body::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: var(--anki-background-overlay, transparent);
  z-index: -1;
}
body:not(.night_mode) {
  --anki-background-image: var(--anki-background-image-light, url('starsky.jpeg'));
  --anki-background-overlay: var(--anki-background-overlay-light, linear-gradient(180deg, rgba(255, 255, 255, 0.32), rgba(255, 255, 255, 0)));
  --anki-background-color: var(--anki-background-color-light, #f0f5ff);
}
body.night_mode {
  --anki-background-image: var(--anki-background-image-dark, url('starsky.jpeg'));
  --anki-background-overlay: var(--anki-background-overlay-dark, rgba(4, 10, 24, 0.45));
  --anki-background-color: var(--anki-background-color-dark, #03060f);
}

/* Ensure the review container is never left hidden */
.is-windows #qa {
  display: block !important;
  visibility: visible !important;
  min-height: 100vh; /* keep enough area to paint */
}

/* Isolate the glass card so filters + transforms don’t collapse a layer */
.is-windows .prettify-flashcard {
  isolation: isolate;            /* new stacking context for filters/blends */
  contain: layout paint;         /* keep compositing local */
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  will-change: transform, filter, backdrop-filter;
  transform: translateZ(0);      /* create its own layer */
}

/* Fixed backgrounds + backdrop-filter are glitchy in Chromium on some GPUs.
   Prefer a scrolling background on Windows to keep the layer stable. */
.is-windows body {
  background-attachment: scroll !important;
}
body::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: var(--anki-background-overlay, transparent);
  z-index: -1;
}
body:not(.night_mode) {
  --anki-background-image: var(--anki-background-image-light, url('starsky.jpeg'));
  --anki-background-overlay: var(--anki-background-overlay-light, linear-gradient(180deg, rgba(255, 255, 255, 0.32), rgba(255, 255, 255, 0)));
  --anki-background-color: var(--anki-background-color-light, #f0f5ff);
}
body.night_mode {
  --anki-background-image: var(--anki-background-image-dark, url('starsky.jpeg'));
  --anki-background-overlay: var(--anki-background-overlay-dark, rgba(4, 10, 24, 0.45));
  --anki-background-color: var(--anki-background-color-dark, #03060f);
}

/* When using heavy glass skins, give text a tiny edge for busy wallpapers */
.is-windows .theme-vitreous,
.is-windows .theme-liquid-glass,
.is-windows .theme-liquid-apple {
  text-shadow: 0 0 1px rgba(0,0,0,.08);
}

/* Optional: slightly stronger backdrop contrast on Windows to reduce “washout” */
.is-windows .theme-vitreous {
  backdrop-filter: blur(26px) saturate(170%) contrast(112%) brightness(104%);
  -webkit-backdrop-filter: blur(26px) saturate(170%) contrast(112%) brightness(104%);
}

/*
ANKIHUB_END
Text below this comment will not be modified by AnkiHub or AnKing add-ons.
Do not edit or remove this comment if you want to protect the content below.
*/






























